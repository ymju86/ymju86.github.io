{% capture logo_path %}{{ site.logo }}{% endcapture %}

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        {% unless logo_path == empty %}
          <a class="site-logo" href="{{ '/' | relative_url }}"><img src="{{ logo_path | relative_url }}" alt="{{ site.masthead_title | default: site.title }}"></a>
        {% endunless %}
        <a class="site-title" href="{{ '/' | relative_url }}">
          {{ site.masthead_title | default: site.title }}
          {% if site.subtitle %}<span class="site-subtitle">{{ site.subtitle }}</span>{% endif %}
        </a>
        <ul class="visible-links">
          {%- for link in site.data.navigation.main -%}
            <li class="masthead__menu-item">
              <a
                href="{{ link.url | relative_url }}"
                {% if link.description %} title="{{ link.description }}"{% endif %}
                {% if link.target %} target="{{ link.target }}"{% endif %}
              >{{ link.title }}</a>
            </li>
          {%- endfor -%}
        </ul>
        {% if site.search == true %}
        <button class="search__toggle" type="button">
          <span class="visually-hidden">{{ site.data.ui-text[site.locale].search_label | default: "Toggle search" }}</span>
          <i class="fas fa-search"></i>
        </button>
        {% endif %}
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">{{ site.data.ui-text[site.locale].menu_label | default: "Toggle menu" }}</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

<style>
.theme-toggle {
  background: none;
  border: none;
  padding: 8px 12px;
  margin-left: 10px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 1.1rem;
  color: #666;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.theme-toggle:hover {
  background-color: rgba(0, 0, 0, 0.1);
  color: #333;
}

[data-theme="dark"] .theme-toggle {
  color: #ccc;
}

[data-theme="dark"] .theme-toggle:hover {
  background-color: rgba(255, 255, 255, 0.1);
  color: #fff;
}

[data-theme="dark"] .theme-icon::before {
  content: "\f185"; /* fa-sun icon */
}

[data-theme="dark"] .masthead {
  background-color: #1a1a1a;
  border-bottom: 1px solid #333;
}

[data-theme="dark"] .site-title {
  color: #fff;
}

[data-theme="dark"] .masthead__menu-item a {
  color: #ccc;
}

[data-theme="dark"] .masthead__menu-item a:hover {
  color: #fff;
}

/* Ensure the toggle works on mobile */
@media (max-width: 768px) {
  .theme-toggle {
    padding: 6px 10px;
    font-size: 1rem;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const themeToggle = document.querySelector('[data-toggle-theme]');
  const html = document.documentElement;
  const themeIcon = themeToggle?.querySelector('.theme-icon');
  
  // Check for saved theme preference or default to light mode
  const currentTheme = localStorage.getItem('theme') || 'light';
  html.setAttribute('data-theme', currentTheme);
  
  // Update icon based on current theme
  function updateIcon(theme) {
    if (themeIcon) {
      if (theme === 'dark') {
        themeIcon.className = 'fas fa-sun theme-icon';
      } else {
        themeIcon.className = 'fas fa-moon theme-icon';
      }
    }
  }
  
  // Set initial icon
  updateIcon(currentTheme);
  
  if (themeToggle) {
    themeToggle.addEventListener('click', function(e) {
      e.preventDefault();
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      
      html.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateIcon(newTheme);
    });
  }
});
</script>
