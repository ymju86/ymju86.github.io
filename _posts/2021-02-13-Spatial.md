---
title: "Basic & Econometrics - Misspecified model - pitfalls"
toc: true
toc_sticky: true
toc_label: Contents
category: "Big Data Econometrics" 
---

```python
def point_inside_polygon(lat,lng,poly):
    p1 = Point(lng,lat)
    if p1.within(poly):
        return True
    else:
        return False
    
def get_neighbourhood(row,gdf):
    for ix, area in gdf.iterrows():
        is_in_area=False
        if row['lat'] and row['lon'] and row['lat']!=0 and row['lon']!=0:
            is_in_area = point_inside_polygon(row['lat'], row['lon'], area['geometry'])
            if is_in_area:
                #found area, exit
                return area['name']
    return None
```


```python
import pandas as pd
import numpy as np
import geopandas as gpd
pd.set_option('display.max_rows', 500)
pd.set_option('display.max_columns', 500)
pd.set_option('display.width', 1000)
from tqdm import tqdm
import matplotlib.pyplot as plt 
tqdm.pandas()
from shapely.geometry import Point, Polygon
data_path = '../data/'
```

    /Users/ida/opt/anaconda3/lib/python3.8/site-packages/tqdm/std.py:697: FutureWarning: The Panel class is removed from pandas. Accessing it from the top-level namespace will also be removed in the next version
      from pandas import Panel
    


```python
def convert_columns_to_lowercase(df):
    df = df.rename(columns = {k:k.lower() for k in df.columns})
    return df
```


```python
df_covid = pd.read_csv(data_path + 'COVID19_by_Neighborhood.csv')
df_covid = convert_columns_to_lowercase(df_covid)
```


```python
renameDict = {'CERT':'cert1'}
df_covid = df_covid.rename(columns = renameDict)
```


```python
{k:k.lower() for k in df_covid.columns}
```




    {'FID': 'fid',
     'COMTY_NAME': 'comty_name',
     'cert1': 'cert1',
     'Shape_Leng': 'shape_leng',
     'Shape_Area': 'shape_area',
     'location': 'location',
     'cases': 'cases',
     'case_rate': 'case_rate',
     'deaths': 'deaths',
     'death_rate': 'death_rate',
     'Date': 'date',
     'Shape__Area': 'shape__area',
     'Shape__Length': 'shape__length'}




```python
df_covid.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FID</th>
      <th>COMTY_NAME</th>
      <th>cert1</th>
      <th>Shape_Leng</th>
      <th>Shape_Area</th>
      <th>location</th>
      <th>cases</th>
      <th>case_rate</th>
      <th>deaths</th>
      <th>death_rate</th>
      <th>Date</th>
      <th>Shape__Area</th>
      <th>Shape__Length</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>SYLMAR</td>
      <td>yes</td>
      <td>111633.753407</td>
      <td>3.404014e+08</td>
      <td>SYLMAR</td>
      <td>14535</td>
      <td>17640</td>
      <td>184</td>
      <td>223</td>
      <td>2021/01/30</td>
      <td>4.647324e+07</td>
      <td>41236.137343</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>GRANADA HILLS</td>
      <td>yes</td>
      <td>89564.685903</td>
      <td>4.264128e+08</td>
      <td>GRANADA HILLS</td>
      <td>5745</td>
      <td>9873</td>
      <td>137</td>
      <td>235</td>
      <td>2021/01/30</td>
      <td>5.818514e+07</td>
      <td>33094.502125</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>PORTER RANCH</td>
      <td>yes</td>
      <td>73616.951350</td>
      <td>2.267371e+08</td>
      <td>PORTER RANCH</td>
      <td>2140</td>
      <td>6013</td>
      <td>23</td>
      <td>65</td>
      <td>2021/01/30</td>
      <td>3.093173e+07</td>
      <td>27183.552463</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>LAKEVIEW TERRACE</td>
      <td>yes</td>
      <td>75477.956189</td>
      <td>1.448471e+08</td>
      <td>LAKEVIEW TERRACE</td>
      <td>2116</td>
      <td>16112</td>
      <td>30</td>
      <td>228</td>
      <td>2021/01/30</td>
      <td>1.975813e+07</td>
      <td>27863.458449</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>MISSION HILLS</td>
      <td>yes</td>
      <td>50728.509850</td>
      <td>1.061586e+08</td>
      <td>MISSION HILLS</td>
      <td>3848</td>
      <td>15951</td>
      <td>96</td>
      <td>398</td>
      <td>2021/01/30</td>
      <td>1.447757e+07</td>
      <td>18746.395093</td>
    </tr>
  </tbody>
</table>
</div>




```bash
%%bash
cd ../data/LA_Times_Neighborhood_Boundaries-shp
ls
```

    cfbcc20d-2c5d-4c30-9dfa-627d46ec1a742020328-1-9ulknm.pzqsm.cpg
    cfbcc20d-2c5d-4c30-9dfa-627d46ec1a742020328-1-9ulknm.pzqsm.dbf
    cfbcc20d-2c5d-4c30-9dfa-627d46ec1a742020328-1-9ulknm.pzqsm.prj
    cfbcc20d-2c5d-4c30-9dfa-627d46ec1a742020328-1-9ulknm.pzqsm.shp
    cfbcc20d-2c5d-4c30-9dfa-627d46ec1a742020328-1-9ulknm.pzqsm.shx
    


```python
gdf = gpd.read_file(data_path + 'LA_Times_Neighborhood_Boundaries-shp/cfbcc20d-2c5d-4c30-9dfa-627d46ec1a742020328-1-9ulknm.pzqsm.shp')
gdf = convert_columns_to_lowercase(gdf)
```


```python
gdf.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>objectid</th>
      <th>name</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Adams-Normandie</td>
      <td>POLYGON ((-118.30069 34.03731, -118.30388 34.0...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Arleta</td>
      <td>POLYGON ((-118.44255 34.26412, -118.44240 34.2...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Arlington Heights</td>
      <td>POLYGON ((-118.31862 34.05306, -118.31673 34.0...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Atwater Village</td>
      <td>MULTIPOLYGON (((-118.27886 34.15321, -118.2788...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Baldwin Hills/Crenshaw</td>
      <td>POLYGON ((-118.36102 34.02532, -118.36026 34.0...</td>
    </tr>
  </tbody>
</table>
</div>




```python
gdf.plot(figsize = (10,10))
```




    <AxesSubplot:>




    
![png](/assets/images/notebooks/BigDataEconometrics/Spatial/output_10_1.png)
    



```python
df_crime = pd.read_csv(data_path + 'Crime_Data_from_2020_to_Present.csv')
df_crime = convert_columns_to_lowercase(df_crime)
```


```python
df_crime.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dr_no</th>
      <th>date rptd</th>
      <th>date occ</th>
      <th>time occ</th>
      <th>area</th>
      <th>area name</th>
      <th>rpt dist no</th>
      <th>part 1-2</th>
      <th>crm cd</th>
      <th>crm cd desc</th>
      <th>mocodes</th>
      <th>vict age</th>
      <th>vict sex</th>
      <th>vict descent</th>
      <th>premis cd</th>
      <th>premis desc</th>
      <th>weapon used cd</th>
      <th>weapon desc</th>
      <th>status</th>
      <th>status desc</th>
      <th>crm cd 1</th>
      <th>crm cd 2</th>
      <th>crm cd 3</th>
      <th>crm cd 4</th>
      <th>location</th>
      <th>cross street</th>
      <th>lat</th>
      <th>lon</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10304468</td>
      <td>01/08/2020 12:00:00 AM</td>
      <td>01/08/2020 12:00:00 AM</td>
      <td>2230</td>
      <td>3</td>
      <td>Southwest</td>
      <td>377</td>
      <td>2</td>
      <td>624</td>
      <td>BATTERY - SIMPLE ASSAULT</td>
      <td>0444 0913</td>
      <td>36</td>
      <td>F</td>
      <td>B</td>
      <td>501.0</td>
      <td>SINGLE FAMILY DWELLING</td>
      <td>400.0</td>
      <td>STRONG-ARM (HANDS, FIST, FEET OR BODILY FORCE)</td>
      <td>AO</td>
      <td>Adult Other</td>
      <td>624.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1100 W  39TH                         PL</td>
      <td>NaN</td>
      <td>34.0141</td>
      <td>-118.2978</td>
    </tr>
    <tr>
      <th>1</th>
      <td>190101086</td>
      <td>01/02/2020 12:00:00 AM</td>
      <td>01/01/2020 12:00:00 AM</td>
      <td>330</td>
      <td>1</td>
      <td>Central</td>
      <td>163</td>
      <td>2</td>
      <td>624</td>
      <td>BATTERY - SIMPLE ASSAULT</td>
      <td>0416 1822 1414</td>
      <td>25</td>
      <td>M</td>
      <td>H</td>
      <td>102.0</td>
      <td>SIDEWALK</td>
      <td>500.0</td>
      <td>UNKNOWN WEAPON/OTHER WEAPON</td>
      <td>IC</td>
      <td>Invest Cont</td>
      <td>624.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>700 S  HILL                         ST</td>
      <td>NaN</td>
      <td>34.0459</td>
      <td>-118.2545</td>
    </tr>
    <tr>
      <th>2</th>
      <td>201220752</td>
      <td>09/16/2020 12:00:00 AM</td>
      <td>09/16/2020 12:00:00 AM</td>
      <td>1230</td>
      <td>12</td>
      <td>77th Street</td>
      <td>1259</td>
      <td>2</td>
      <td>745</td>
      <td>VANDALISM - MISDEAMEANOR ($399 OR UNDER)</td>
      <td>2004 1820 0913 0329 1202</td>
      <td>62</td>
      <td>M</td>
      <td>B</td>
      <td>502.0</td>
      <td>MULTI-UNIT DWELLING (APARTMENT, DUPLEX, ETC)</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>IC</td>
      <td>Invest Cont</td>
      <td>745.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>700 E  73RD                         ST</td>
      <td>NaN</td>
      <td>33.9739</td>
      <td>-118.2630</td>
    </tr>
    <tr>
      <th>3</th>
      <td>191501505</td>
      <td>01/01/2020 12:00:00 AM</td>
      <td>01/01/2020 12:00:00 AM</td>
      <td>1730</td>
      <td>15</td>
      <td>N Hollywood</td>
      <td>1543</td>
      <td>2</td>
      <td>745</td>
      <td>VANDALISM - MISDEAMEANOR ($399 OR UNDER)</td>
      <td>0329 1402</td>
      <td>76</td>
      <td>F</td>
      <td>W</td>
      <td>502.0</td>
      <td>MULTI-UNIT DWELLING (APARTMENT, DUPLEX, ETC)</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>IC</td>
      <td>Invest Cont</td>
      <td>745.0</td>
      <td>998.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5400    CORTEEN                      PL</td>
      <td>NaN</td>
      <td>34.1685</td>
      <td>-118.4019</td>
    </tr>
    <tr>
      <th>4</th>
      <td>191921269</td>
      <td>01/01/2020 12:00:00 AM</td>
      <td>01/01/2020 12:00:00 AM</td>
      <td>415</td>
      <td>19</td>
      <td>Mission</td>
      <td>1998</td>
      <td>2</td>
      <td>740</td>
      <td>VANDALISM - FELONY ($400 &amp; OVER, ALL CHURCH VA...</td>
      <td>0329</td>
      <td>31</td>
      <td>X</td>
      <td>X</td>
      <td>409.0</td>
      <td>BEAUTY SUPPLY STORE</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>IC</td>
      <td>Invest Cont</td>
      <td>740.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>14400    TITUS                        ST</td>
      <td>NaN</td>
      <td>34.2198</td>
      <td>-118.4468</td>
    </tr>
  </tbody>
</table>
</div>




```python
def sum_coordinates(row):
    return row['lat']+ row['lon']
```


```python
df_crime['sumcoord'] = df_crime.apply(lambda row: sum_coordinates(row),axis = 1)
```


```python
df_crime.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dr_no</th>
      <th>date rptd</th>
      <th>date occ</th>
      <th>time occ</th>
      <th>area</th>
      <th>area name</th>
      <th>rpt dist no</th>
      <th>part 1-2</th>
      <th>crm cd</th>
      <th>crm cd desc</th>
      <th>mocodes</th>
      <th>vict age</th>
      <th>vict sex</th>
      <th>vict descent</th>
      <th>premis cd</th>
      <th>premis desc</th>
      <th>weapon used cd</th>
      <th>weapon desc</th>
      <th>status</th>
      <th>status desc</th>
      <th>crm cd 1</th>
      <th>crm cd 2</th>
      <th>crm cd 3</th>
      <th>crm cd 4</th>
      <th>location</th>
      <th>cross street</th>
      <th>lat</th>
      <th>lon</th>
      <th>sumcoord</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10304468</td>
      <td>01/08/2020 12:00:00 AM</td>
      <td>01/08/2020 12:00:00 AM</td>
      <td>2230</td>
      <td>3</td>
      <td>Southwest</td>
      <td>377</td>
      <td>2</td>
      <td>624</td>
      <td>BATTERY - SIMPLE ASSAULT</td>
      <td>0444 0913</td>
      <td>36</td>
      <td>F</td>
      <td>B</td>
      <td>501.0</td>
      <td>SINGLE FAMILY DWELLING</td>
      <td>400.0</td>
      <td>STRONG-ARM (HANDS, FIST, FEET OR BODILY FORCE)</td>
      <td>AO</td>
      <td>Adult Other</td>
      <td>624.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1100 W  39TH                         PL</td>
      <td>NaN</td>
      <td>34.0141</td>
      <td>-118.2978</td>
      <td>-84.2837</td>
    </tr>
    <tr>
      <th>1</th>
      <td>190101086</td>
      <td>01/02/2020 12:00:00 AM</td>
      <td>01/01/2020 12:00:00 AM</td>
      <td>330</td>
      <td>1</td>
      <td>Central</td>
      <td>163</td>
      <td>2</td>
      <td>624</td>
      <td>BATTERY - SIMPLE ASSAULT</td>
      <td>0416 1822 1414</td>
      <td>25</td>
      <td>M</td>
      <td>H</td>
      <td>102.0</td>
      <td>SIDEWALK</td>
      <td>500.0</td>
      <td>UNKNOWN WEAPON/OTHER WEAPON</td>
      <td>IC</td>
      <td>Invest Cont</td>
      <td>624.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>700 S  HILL                         ST</td>
      <td>NaN</td>
      <td>34.0459</td>
      <td>-118.2545</td>
      <td>-84.2086</td>
    </tr>
    <tr>
      <th>2</th>
      <td>201220752</td>
      <td>09/16/2020 12:00:00 AM</td>
      <td>09/16/2020 12:00:00 AM</td>
      <td>1230</td>
      <td>12</td>
      <td>77th Street</td>
      <td>1259</td>
      <td>2</td>
      <td>745</td>
      <td>VANDALISM - MISDEAMEANOR ($399 OR UNDER)</td>
      <td>2004 1820 0913 0329 1202</td>
      <td>62</td>
      <td>M</td>
      <td>B</td>
      <td>502.0</td>
      <td>MULTI-UNIT DWELLING (APARTMENT, DUPLEX, ETC)</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>IC</td>
      <td>Invest Cont</td>
      <td>745.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>700 E  73RD                         ST</td>
      <td>NaN</td>
      <td>33.9739</td>
      <td>-118.2630</td>
      <td>-84.2891</td>
    </tr>
    <tr>
      <th>3</th>
      <td>191501505</td>
      <td>01/01/2020 12:00:00 AM</td>
      <td>01/01/2020 12:00:00 AM</td>
      <td>1730</td>
      <td>15</td>
      <td>N Hollywood</td>
      <td>1543</td>
      <td>2</td>
      <td>745</td>
      <td>VANDALISM - MISDEAMEANOR ($399 OR UNDER)</td>
      <td>0329 1402</td>
      <td>76</td>
      <td>F</td>
      <td>W</td>
      <td>502.0</td>
      <td>MULTI-UNIT DWELLING (APARTMENT, DUPLEX, ETC)</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>IC</td>
      <td>Invest Cont</td>
      <td>745.0</td>
      <td>998.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5400    CORTEEN                      PL</td>
      <td>NaN</td>
      <td>34.1685</td>
      <td>-118.4019</td>
      <td>-84.2334</td>
    </tr>
    <tr>
      <th>4</th>
      <td>191921269</td>
      <td>01/01/2020 12:00:00 AM</td>
      <td>01/01/2020 12:00:00 AM</td>
      <td>415</td>
      <td>19</td>
      <td>Mission</td>
      <td>1998</td>
      <td>2</td>
      <td>740</td>
      <td>VANDALISM - FELONY ($400 &amp; OVER, ALL CHURCH VA...</td>
      <td>0329</td>
      <td>31</td>
      <td>X</td>
      <td>X</td>
      <td>409.0</td>
      <td>BEAUTY SUPPLY STORE</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>IC</td>
      <td>Invest Cont</td>
      <td>740.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>14400    TITUS                        ST</td>
      <td>NaN</td>
      <td>34.2198</td>
      <td>-118.4468</td>
      <td>-84.2270</td>
    </tr>
  </tbody>
</table>
</div>




```python

```


```python
dfc = df_crime.head(10000) # sample 10,0000
```


```python
def point_inside_polygon(lat,lng,poly):
    p1 = Point(lng,lat)
    if p1.within(poly):
        return True
    else:
        return False
    
def get_neighbourhood(row,gdf):
    for ix, area in gdf.iterrows(): # geometry df
        is_in_area=False
        if row['lat'] and row['lon'] and row['lat']!=0 and row['lon']!=0:
            is_in_area = point_inside_polygon(row['lat'], row['lon'], area['geometry'])
            if is_in_area:
                #found area, exit
                return area['name']
    return None
```


```python
dfc['name'] = dfc.progress_apply(lambda row: get_neighbourhood(row,gdf), axis = 1)


```

    100%|██████████| 10000/10000 [01:30<00:00, 110.39it/s]
    <ipython-input-33-5acc60d73ec9>:1: SettingWithCopyWarning: 
    A value is trying to be set on a copy of a slice from a DataFrame.
    Try using .loc[row_indexer,col_indexer] = value instead
    
    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
      dfc['name'] = dfc.progress_apply(lambda row: get_neighbourhood(row,gdf), axis = 1)
    


```python
dfc.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>dr_no</th>
      <th>date rptd</th>
      <th>date occ</th>
      <th>time occ</th>
      <th>area</th>
      <th>area name</th>
      <th>rpt dist no</th>
      <th>part 1-2</th>
      <th>crm cd</th>
      <th>crm cd desc</th>
      <th>mocodes</th>
      <th>vict age</th>
      <th>vict sex</th>
      <th>vict descent</th>
      <th>premis cd</th>
      <th>premis desc</th>
      <th>weapon used cd</th>
      <th>weapon desc</th>
      <th>status</th>
      <th>status desc</th>
      <th>crm cd 1</th>
      <th>crm cd 2</th>
      <th>crm cd 3</th>
      <th>crm cd 4</th>
      <th>location</th>
      <th>cross street</th>
      <th>lat</th>
      <th>lon</th>
      <th>name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10304468</td>
      <td>01/08/2020 12:00:00 AM</td>
      <td>01/08/2020 12:00:00 AM</td>
      <td>2230</td>
      <td>3</td>
      <td>Southwest</td>
      <td>377</td>
      <td>2</td>
      <td>624</td>
      <td>BATTERY - SIMPLE ASSAULT</td>
      <td>0444 0913</td>
      <td>36</td>
      <td>F</td>
      <td>B</td>
      <td>501.0</td>
      <td>SINGLE FAMILY DWELLING</td>
      <td>400.0</td>
      <td>STRONG-ARM (HANDS, FIST, FEET OR BODILY FORCE)</td>
      <td>AO</td>
      <td>Adult Other</td>
      <td>624.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1100 W  39TH                         PL</td>
      <td>NaN</td>
      <td>34.0141</td>
      <td>-118.2978</td>
      <td>Exposition Park</td>
    </tr>
    <tr>
      <th>1</th>
      <td>190101086</td>
      <td>01/02/2020 12:00:00 AM</td>
      <td>01/01/2020 12:00:00 AM</td>
      <td>330</td>
      <td>1</td>
      <td>Central</td>
      <td>163</td>
      <td>2</td>
      <td>624</td>
      <td>BATTERY - SIMPLE ASSAULT</td>
      <td>0416 1822 1414</td>
      <td>25</td>
      <td>M</td>
      <td>H</td>
      <td>102.0</td>
      <td>SIDEWALK</td>
      <td>500.0</td>
      <td>UNKNOWN WEAPON/OTHER WEAPON</td>
      <td>IC</td>
      <td>Invest Cont</td>
      <td>624.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>700 S  HILL                         ST</td>
      <td>NaN</td>
      <td>34.0459</td>
      <td>-118.2545</td>
      <td>Downtown</td>
    </tr>
    <tr>
      <th>2</th>
      <td>201220752</td>
      <td>09/16/2020 12:00:00 AM</td>
      <td>09/16/2020 12:00:00 AM</td>
      <td>1230</td>
      <td>12</td>
      <td>77th Street</td>
      <td>1259</td>
      <td>2</td>
      <td>745</td>
      <td>VANDALISM - MISDEAMEANOR ($399 OR UNDER)</td>
      <td>2004 1820 0913 0329 1202</td>
      <td>62</td>
      <td>M</td>
      <td>B</td>
      <td>502.0</td>
      <td>MULTI-UNIT DWELLING (APARTMENT, DUPLEX, ETC)</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>IC</td>
      <td>Invest Cont</td>
      <td>745.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>700 E  73RD                         ST</td>
      <td>NaN</td>
      <td>33.9739</td>
      <td>-118.2630</td>
      <td>Florence</td>
    </tr>
    <tr>
      <th>3</th>
      <td>191501505</td>
      <td>01/01/2020 12:00:00 AM</td>
      <td>01/01/2020 12:00:00 AM</td>
      <td>1730</td>
      <td>15</td>
      <td>N Hollywood</td>
      <td>1543</td>
      <td>2</td>
      <td>745</td>
      <td>VANDALISM - MISDEAMEANOR ($399 OR UNDER)</td>
      <td>0329 1402</td>
      <td>76</td>
      <td>F</td>
      <td>W</td>
      <td>502.0</td>
      <td>MULTI-UNIT DWELLING (APARTMENT, DUPLEX, ETC)</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>IC</td>
      <td>Invest Cont</td>
      <td>745.0</td>
      <td>998.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5400    CORTEEN                      PL</td>
      <td>NaN</td>
      <td>34.1685</td>
      <td>-118.4019</td>
      <td>Valley Village</td>
    </tr>
    <tr>
      <th>4</th>
      <td>191921269</td>
      <td>01/01/2020 12:00:00 AM</td>
      <td>01/01/2020 12:00:00 AM</td>
      <td>415</td>
      <td>19</td>
      <td>Mission</td>
      <td>1998</td>
      <td>2</td>
      <td>740</td>
      <td>VANDALISM - FELONY ($400 &amp; OVER, ALL CHURCH VA...</td>
      <td>0329</td>
      <td>31</td>
      <td>X</td>
      <td>X</td>
      <td>409.0</td>
      <td>BEAUTY SUPPLY STORE</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>IC</td>
      <td>Invest Cont</td>
      <td>740.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>14400    TITUS                        ST</td>
      <td>NaN</td>
      <td>34.2198</td>
      <td>-118.4468</td>
      <td>Panorama City</td>
    </tr>
  </tbody>
</table>
</div>




```python
crime_counts = dfc[['name','dr_no']].groupby('name').count().reset_index().rename(columns = {'dr_no':'n'})
crime_counts
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>n</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Adams-Normandie</td>
      <td>69</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Arleta</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arlington Heights</td>
      <td>57</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Atwater Village</td>
      <td>23</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Baldwin Hills/Crenshaw</td>
      <td>146</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Bel-Air</td>
      <td>14</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Beverly Crest</td>
      <td>23</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Beverly Grove</td>
      <td>198</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Beverlywood</td>
      <td>13</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Boyle Heights</td>
      <td>423</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Brentwood</td>
      <td>95</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Broadway-Manchester</td>
      <td>31</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Canoga Park</td>
      <td>27</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Carthay</td>
      <td>36</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Central-Alameda</td>
      <td>16</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Century City</td>
      <td>37</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Chatsworth</td>
      <td>17</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Chesterfield Square</td>
      <td>5</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Cheviot Hills</td>
      <td>21</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Chinatown</td>
      <td>93</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Cypress Park</td>
      <td>23</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Del Rey</td>
      <td>12</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Downtown</td>
      <td>1121</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Eagle Rock</td>
      <td>33</td>
    </tr>
    <tr>
      <th>24</th>
      <td>East Hollywood</td>
      <td>216</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Echo Park</td>
      <td>140</td>
    </tr>
    <tr>
      <th>26</th>
      <td>El Sereno</td>
      <td>152</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Elysian Park</td>
      <td>27</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Elysian Valley</td>
      <td>11</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Encino</td>
      <td>135</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Exposition Park</td>
      <td>194</td>
    </tr>
    <tr>
      <th>31</th>
      <td>Fairfax</td>
      <td>146</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Florence</td>
      <td>31</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Glassell Park</td>
      <td>44</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Gramercy Park</td>
      <td>5</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Granada Hills</td>
      <td>12</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Green Meadows</td>
      <td>24</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Griffith Park</td>
      <td>15</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Hancock Park</td>
      <td>49</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Hansen Dam</td>
      <td>2</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Harbor City</td>
      <td>82</td>
    </tr>
    <tr>
      <th>41</th>
      <td>Harbor Gateway</td>
      <td>94</td>
    </tr>
    <tr>
      <th>42</th>
      <td>Harvard Heights</td>
      <td>11</td>
    </tr>
    <tr>
      <th>43</th>
      <td>Harvard Park</td>
      <td>11</td>
    </tr>
    <tr>
      <th>44</th>
      <td>Highland Park</td>
      <td>79</td>
    </tr>
    <tr>
      <th>45</th>
      <td>Historic South-Central</td>
      <td>39</td>
    </tr>
    <tr>
      <th>46</th>
      <td>Hollywood</td>
      <td>673</td>
    </tr>
    <tr>
      <th>47</th>
      <td>Hollywood Hills</td>
      <td>81</td>
    </tr>
    <tr>
      <th>48</th>
      <td>Hollywood Hills West</td>
      <td>56</td>
    </tr>
    <tr>
      <th>49</th>
      <td>Hyde Park</td>
      <td>40</td>
    </tr>
    <tr>
      <th>50</th>
      <td>Jefferson Park</td>
      <td>121</td>
    </tr>
    <tr>
      <th>51</th>
      <td>Koreatown</td>
      <td>56</td>
    </tr>
    <tr>
      <th>52</th>
      <td>Lake Balboa</td>
      <td>74</td>
    </tr>
    <tr>
      <th>53</th>
      <td>Lake View Terrace</td>
      <td>5</td>
    </tr>
    <tr>
      <th>54</th>
      <td>Larchmont</td>
      <td>6</td>
    </tr>
    <tr>
      <th>55</th>
      <td>Leimert Park</td>
      <td>107</td>
    </tr>
    <tr>
      <th>56</th>
      <td>Lincoln Heights</td>
      <td>109</td>
    </tr>
    <tr>
      <th>57</th>
      <td>Los Feliz</td>
      <td>80</td>
    </tr>
    <tr>
      <th>58</th>
      <td>Manchester Square</td>
      <td>6</td>
    </tr>
    <tr>
      <th>59</th>
      <td>Mar Vista</td>
      <td>4</td>
    </tr>
    <tr>
      <th>60</th>
      <td>Mid-City</td>
      <td>219</td>
    </tr>
    <tr>
      <th>61</th>
      <td>Mid-Wilshire</td>
      <td>195</td>
    </tr>
    <tr>
      <th>62</th>
      <td>Mission Hills</td>
      <td>8</td>
    </tr>
    <tr>
      <th>63</th>
      <td>Montecito Heights</td>
      <td>40</td>
    </tr>
    <tr>
      <th>64</th>
      <td>Mount Washington</td>
      <td>21</td>
    </tr>
    <tr>
      <th>65</th>
      <td>North Hills</td>
      <td>26</td>
    </tr>
    <tr>
      <th>66</th>
      <td>North Hollywood</td>
      <td>37</td>
    </tr>
    <tr>
      <th>67</th>
      <td>Northridge</td>
      <td>27</td>
    </tr>
    <tr>
      <th>68</th>
      <td>Pacific Palisades</td>
      <td>55</td>
    </tr>
    <tr>
      <th>69</th>
      <td>Pacoima</td>
      <td>35</td>
    </tr>
    <tr>
      <th>70</th>
      <td>Palms</td>
      <td>28</td>
    </tr>
    <tr>
      <th>71</th>
      <td>Panorama City</td>
      <td>26</td>
    </tr>
    <tr>
      <th>72</th>
      <td>Pico-Robertson</td>
      <td>65</td>
    </tr>
    <tr>
      <th>73</th>
      <td>Pico-Union</td>
      <td>83</td>
    </tr>
    <tr>
      <th>74</th>
      <td>Playa Vista</td>
      <td>3</td>
    </tr>
    <tr>
      <th>75</th>
      <td>Playa del Rey</td>
      <td>2</td>
    </tr>
    <tr>
      <th>76</th>
      <td>Porter Ranch</td>
      <td>2</td>
    </tr>
    <tr>
      <th>77</th>
      <td>Rancho Park</td>
      <td>14</td>
    </tr>
    <tr>
      <th>78</th>
      <td>Reseda</td>
      <td>268</td>
    </tr>
    <tr>
      <th>79</th>
      <td>San Pedro</td>
      <td>288</td>
    </tr>
    <tr>
      <th>80</th>
      <td>Sawtelle</td>
      <td>153</td>
    </tr>
    <tr>
      <th>81</th>
      <td>Sepulveda Basin</td>
      <td>20</td>
    </tr>
    <tr>
      <th>82</th>
      <td>Shadow Hills</td>
      <td>3</td>
    </tr>
    <tr>
      <th>83</th>
      <td>Sherman Oaks</td>
      <td>258</td>
    </tr>
    <tr>
      <th>84</th>
      <td>Silver Lake</td>
      <td>90</td>
    </tr>
    <tr>
      <th>85</th>
      <td>South Park</td>
      <td>22</td>
    </tr>
    <tr>
      <th>86</th>
      <td>Studio City</td>
      <td>24</td>
    </tr>
    <tr>
      <th>87</th>
      <td>Sun Valley</td>
      <td>32</td>
    </tr>
    <tr>
      <th>88</th>
      <td>Sunland</td>
      <td>6</td>
    </tr>
    <tr>
      <th>89</th>
      <td>Sylmar</td>
      <td>28</td>
    </tr>
    <tr>
      <th>90</th>
      <td>Tarzana</td>
      <td>164</td>
    </tr>
    <tr>
      <th>91</th>
      <td>Toluca Lake</td>
      <td>6</td>
    </tr>
    <tr>
      <th>92</th>
      <td>Tujunga</td>
      <td>9</td>
    </tr>
    <tr>
      <th>93</th>
      <td>University Park</td>
      <td>157</td>
    </tr>
    <tr>
      <th>94</th>
      <td>Valley Glen</td>
      <td>114</td>
    </tr>
    <tr>
      <th>95</th>
      <td>Valley Village</td>
      <td>12</td>
    </tr>
    <tr>
      <th>96</th>
      <td>Van Nuys</td>
      <td>492</td>
    </tr>
    <tr>
      <th>97</th>
      <td>Venice</td>
      <td>29</td>
    </tr>
    <tr>
      <th>98</th>
      <td>Vermont Knolls</td>
      <td>15</td>
    </tr>
    <tr>
      <th>99</th>
      <td>Vermont Square</td>
      <td>135</td>
    </tr>
    <tr>
      <th>100</th>
      <td>Vermont Vista</td>
      <td>17</td>
    </tr>
    <tr>
      <th>101</th>
      <td>Vermont-Slauson</td>
      <td>24</td>
    </tr>
    <tr>
      <th>102</th>
      <td>Watts</td>
      <td>17</td>
    </tr>
    <tr>
      <th>103</th>
      <td>West Adams</td>
      <td>96</td>
    </tr>
    <tr>
      <th>104</th>
      <td>West Hills</td>
      <td>11</td>
    </tr>
    <tr>
      <th>105</th>
      <td>West Los Angeles</td>
      <td>69</td>
    </tr>
    <tr>
      <th>106</th>
      <td>Westchester</td>
      <td>40</td>
    </tr>
    <tr>
      <th>107</th>
      <td>Westlake</td>
      <td>544</td>
    </tr>
    <tr>
      <th>108</th>
      <td>Westwood</td>
      <td>105</td>
    </tr>
    <tr>
      <th>109</th>
      <td>Wilmington</td>
      <td>232</td>
    </tr>
    <tr>
      <th>110</th>
      <td>Windsor Square</td>
      <td>8</td>
    </tr>
    <tr>
      <th>111</th>
      <td>Winnetka</td>
      <td>15</td>
    </tr>
    <tr>
      <th>112</th>
      <td>Woodland Hills</td>
      <td>27</td>
    </tr>
  </tbody>
</table>
</div>




```python
# fig, ax = plt.subplots(figsize = (30,30)) 
# gdf[gdf.location!='CENTRAL'].plot(ax = ax, color = 'blue')
# gdf[gdf.location=='CENTRAL'].plot(ax = ax, color = 'red')
```


```python
gdf[gdf.fid==75]
```


```python
gdf = gdf.merge(crime_counts,on = 'name',how = 'left')
```


```python
gdf.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>objectid</th>
      <th>name</th>
      <th>geometry</th>
      <th>n</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Adams-Normandie</td>
      <td>POLYGON ((-118.30069 34.03731, -118.30388 34.0...</td>
      <td>69.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Arleta</td>
      <td>POLYGON ((-118.44255 34.26412, -118.44240 34.2...</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Arlington Heights</td>
      <td>POLYGON ((-118.31862 34.05306, -118.31673 34.0...</td>
      <td>57.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Atwater Village</td>
      <td>MULTIPOLYGON (((-118.27886 34.15321, -118.2788...</td>
      <td>23.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Baldwin Hills/Crenshaw</td>
      <td>POLYGON ((-118.36102 34.02532, -118.36026 34.0...</td>
      <td>146.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
fig, ax = plt.subplots(1,figsize = (15,15)) # create figure and axes for Matplotlib
ax.set_title('Crime counts by neighborhood',
            fontdict={'fontsize': '25', 'fontweight' : '3'})

vmin = gdf.n.min()
vmax = gdf.n.max()

gdf.plot(column = 'n',cmap = 'Greens',linewidth = 1, ax = ax, edgecolor = '.5')
# remove the axis
ax.axis('off')

# Create colorbar legend
sm = plt.cm.ScalarMappable(cmap='Greens', norm=plt.Normalize(vmin=vmin, vmax=vmax))

# empty array for the data range
sm.set_array([])

#add colorbar
cbar = fig.colorbar(sm)

# Add location for the labels
gdf['coords'] = gdf['geometry'].apply(lambda x: x.representative_point().coords[:])
gdf['coords'] = [coords[0] for coords in gdf['coords']]

# Display names 
for idx, row in gdf.iterrows():
    plt.annotate(s=row['name'], xy=row['coords'],horizontalalignment='center',fontsize=9,color = 'white')
```

    <ipython-input-44-d2ef1ee917c5>:27: MatplotlibDeprecationWarning: The 's' parameter of annotate() has been renamed 'text' since Matplotlib 3.3; support for the old name will be dropped two minor releases later.
      plt.annotate(s=row['name'], xy=row['coords'],horizontalalignment='center',fontsize=9,color = 'white')
    


    
![png](/assets/images/notebooks/BigDataEconometrics/Spatial/output_26_1.png)
    


Matplotlib colormaps:
https://matplotlib.org/stable/tutorials/colors/colormaps.html


```python
gdf2 = gpd.read_file(data_path + 'COVID19_by_Neighborhood-shp/COVID19_by_Neighborhood.shp')
gdf2 = convert_columns_to_lowercase(gdf2)

```


```python
gdf2.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fid</th>
      <th>comty_name</th>
      <th>cert</th>
      <th>shape_leng</th>
      <th>shape_area</th>
      <th>location</th>
      <th>cases</th>
      <th>case_rate</th>
      <th>deaths</th>
      <th>death_rate</th>
      <th>date</th>
      <th>shape__are</th>
      <th>shape__len</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>GRANADA HILLS</td>
      <td>yes</td>
      <td>89564.685903</td>
      <td>4.264128e+08</td>
      <td>GRANADA HILLS</td>
      <td>457</td>
      <td>785</td>
      <td>48</td>
      <td>82</td>
      <td>2020-06-18</td>
      <td>5.818514e+07</td>
      <td>33094.502125</td>
      <td>POLYGON ((-118.54219 34.29860, -118.54084 34.2...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>PORTER RANCH</td>
      <td>yes</td>
      <td>73616.951350</td>
      <td>2.267371e+08</td>
      <td>PORTER RANCH</td>
      <td>111</td>
      <td>312</td>
      <td>7</td>
      <td>20</td>
      <td>2020-06-18</td>
      <td>3.093173e+07</td>
      <td>27183.552463</td>
      <td>POLYGON ((-118.59618 34.27462, -118.59377 34.2...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>LAKEVIEW TERRACE</td>
      <td>yes</td>
      <td>75477.956189</td>
      <td>1.448471e+08</td>
      <td>LAKEVIEW TERRACE</td>
      <td>158</td>
      <td>1203</td>
      <td>4</td>
      <td>30</td>
      <td>2020-06-18</td>
      <td>1.975813e+07</td>
      <td>27863.458449</td>
      <td>POLYGON ((-118.40834 34.28671, -118.40755 34.2...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>MISSION HILLS</td>
      <td>yes</td>
      <td>50728.509850</td>
      <td>1.061586e+08</td>
      <td>MISSION HILLS</td>
      <td>214</td>
      <td>887</td>
      <td>10</td>
      <td>41</td>
      <td>2020-06-18</td>
      <td>1.447757e+07</td>
      <td>18746.395093</td>
      <td>POLYGON ((-118.47067 34.29432, -118.46554 34.2...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>ANGELES NATIONAL FOREST</td>
      <td>yes</td>
      <td>92240.837542</td>
      <td>1.458565e+08</td>
      <td>ANGELES NATIONAL FOREST</td>
      <td>1</td>
      <td>2500</td>
      <td>0</td>
      <td>0</td>
      <td>2020-06-18</td>
      <td>1.989453e+07</td>
      <td>34046.544055</td>
      <td>POLYGON ((-118.33605 34.28250, -118.33494 34.2...</td>
    </tr>
  </tbody>
</table>
</div>




```python
fig, ax = plt.subplots(1,figsize = (10,10)) # create figure and axes for Matplotlib
ax.set_title('Covid deaths by neighborhood',
            fontdict={'fontsize': '25', 'fontweight' : '3'})

vmin = gdf2.deaths.min()
vmax = gdf2.deaths.max()

gdf2.plot(column = 'deaths',cmap = 'viridis',linewidth = 1, ax = ax, edgecolor = '.5')
# remove the axis
ax.axis('off')

# Create colorbar legend
sm = plt.cm.ScalarMappable(cmap='viridis', norm=plt.Normalize(vmin=vmin, vmax=vmax))

# empty array for the data range
sm.set_array([])

#add colorbar
cbar = fig.colorbar(sm)

# Add location for the labels
gdf['coords'] = gdf['geometry'].apply(lambda x: x.representative_point().coords[:])
gdf['coords'] = [coords[0] for coords in gdf['coords']]

# # Display names 
# for idx, row in gdf.iterrows():
#     plt.annotate(s=row['n'], xy=row['coords'],horizontalalignment='center',fontsize=9)
```


    
![png](/assets/images/notebooks/BigDataEconometrics/Spatial/output_30_0.png)
    



```python
gdf2 = gdf2.merge(df_covid[['fid','cases','case_rate','deaths','death_rate']], on = 'fid')
```


```python
gdf2.head()
```

### Spatial joins using sjoin


```python

```


```python

```


```python

```


```python

```


```python

```

### 1 to many mappings


```python
d = {'col1': [1, 2], 'col2': [3, 4]}
df = pd.DataFrame(data=d)
```
